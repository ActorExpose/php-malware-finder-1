VERSION=1.0
DEBVER := $(shell cut -d'.' -f1 < /etc/debian_version)


clean:
	rm -rf php-malware-finder/debian
	rm -f *.build *.changes *.deb

extract:
	cp -r debian php-malware-finder
	git checkout php-malware-finder/malwares.yara

set_distribution:
		sed -e "s/##version/`cut -d'.' -f1 < /etc/debian_version`/" -i php-malware-finder/debian/control php-malware-finder/debian/changelog

check_distribution:
ifeq ($(DEBVER),6)
		sed -e 's/^import.*//g' -e 's/^include.*//g' -e 's/and\ not\ IsWhitelisted//g' -i php-malware-finder/malwares.yara
endif

package: clean extract set_distribution check_distribution
	cd php-malware-finder && debuild -b -us -uc --lintian-opts -X po-debconf
